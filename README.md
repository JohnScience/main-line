# What is this project about?

This is a project that was created for the purpose of learning Next.js.

It is a multi-container Docker compose application that includes:

* A Rust backend service using Actix-web and SQLx,
* A Next.js TypeScript frontend application (with App Router, Tailwind CSS, and React) that communicates with the backend using the API client generated by `gen-api-client` using [`openapi-ts`](https://github.com/hey-api/openapi-ts) based on the OpenAPI specification provided by the backend and the `gen-api-client/api-client-template` template with custom modifications for QoL improvements,
* A PostgreSQL database,
* A PgAdmin service for database management.

# Running the project

## Dependencies

* Git
* Python
* Docker
* Docker Compose

## How to run

Once you have the dependencies installed, follow these steps:

* Clone the repository to your local machine.
* Navigate to the project directory.

* Generate the secret files using the Python script:

```bash
python -m scripts.generate_secrets
```

* Generate the TLS certificates using the Python script:

```bash
python -m scripts.generate_certs
```

* Build the intermediate Docker images using the Python script:

```bash
python -m scripts.build_intermediate_images
```

*Note: Ideally, this should be done using `additional_contexts` feature of Docker compose. However, my builder of version `v2.33.1-desktop.1` doesn't support it. Here's how I suppose it could be possible.*

```yml
backend-lib:
    build:
      context: ./
      dockerfile: Dockerfile.backend-lib
      # The docs (https://docs.docker.com/compose/how-tos/dependent-images/#use-another-services-image-as-the-base-image) state it should work
      # but it doesn't
      additional_contexts:
        # `FROM main-line-rust-workspace AS rust-workspace` would reference this image
        main-line-rust-workspace: "service:rust-workspace"
    profiles: ["build-only"]
```

* Run the multi-container application using Docker Compose:

```bash
docker compose up --build
```

# Testing the project

## Backend

### Health Check

To check if the `backend` service is running correctly, you can check whether the <localhost:3000/health-check> endpoint returns a `200 OK` status.

```bash
curl -i http://localhost:3000/health-check
```

### API Documentation

For the full list of available endpoints, navigate to <http://localhost:3000/swagger-ui/>.

### Postman Collection

For the Postman collection, please navigate to <https://www.postman.com/flight-saganist-17578370/workspace/mainline>.

# Development

Working on the project heavily depends on code-generation. To extract the code-generated artifacts from the built Docker images, run:

```bash
python -m scripts.extract_artifacts
```

# Images

To learn more about the Docker images used in this project, read the comments in the `scripts/common/docker_images.py` file.
